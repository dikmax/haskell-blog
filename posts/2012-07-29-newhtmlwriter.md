---
title: Обновление блога
date: 2012-07-29T19:53:15+03:00
tags: haskell, блог, программирование
---

Совершенно внезапно наш блог постигло самое масштабное внутреннее обновление со времен его создания. Я сделал то, что давно собирался: написал полностью свой рендерер для постов. Теперь я полностью отвечаю за внешний вид постов, а не какой-то там [Text.Pandoc.Writers.HTML](http://hackage.haskell.org/packages/archive/pandoc/1.9.4.2/doc/html/Text-Pandoc-Writers-HTML.html).


Теперь я могу реализовывать (и уже начал) всякие специальные прикольные штуки, например, другие сноски. Они теперь отображаются не внизу поста, а прямо в нужном месте при нажатии на соответсвующую ссылку мышкой[^1]. 

Самая жесть во всем написанном коде --- это обработка raw-данных. Как вы, возможно, знаете, в markdown можно [вставлять голый html](http://daringfireball.net/projects/markdown/syntax#html), не обязательно валидный. А [Pandoc](http://johnmacfarlane.net/pandoc/), парсер для markdown, позволяет еще и смешивать raw-данные и специальную размету. Например, из такого текста:

~~~~~markdown
<span>*Текст*</span>
~~~~~

будет получен следующий результат:

~~~~~html
<span><em>Текст</em></span>
~~~~~

Добавим к этому, что используемый шаблонизатор heist оперирует только валидными структурами. Вот и получаем, что блоки, которые содержат raw-данные, сначала собираются в виде html-строки, а затем парсятся в валидную структуру для шаблонизатора. В то же время для любых других блоков стуктуру для heist можно генерировать напрямую.

В любом случае смотрим, изучаем, находим ошибки и сообщаем мне о них.

[^1]: Да-да, вот прямо как сейчас.
